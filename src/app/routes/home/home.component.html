<section class="mat-elevation-z11">
  <div class="header">
    <form [formGroup]="formGroup" (ngSubmit)="sendForm()">
      <mat-form-field class="municipio" appearance="outline" floatLabel="always" color="warn">
        <mat-label>Municipio</mat-label>
        <input type="text" placeholder="Escribe para buscar un municipio..." aria-label="Number" matInput
          formControlName="municipio" [matAutocomplete]="auto">
        <button matSuffix mat-icon-button aria-label="Limpiar campo municipio"
          (click)="formGroup.controls['municipio'].reset()" *ngIf="formGroup.controls['municipio'].value">
          <mat-icon>close</mat-icon>
        </button>
        <mat-autocomplete #auto="matAutocomplete" (optionSelected)="sendForm()" [displayWith]="displayFn">
          @for (option of municipios; track option.id) {
          <mat-option [value]="option">{{option.nombre}}</mat-option>
          }
        </mat-autocomplete>
      </mat-form-field>
      <mat-form-field appearance="outline" class="unidad">
        <mat-label>Unidad</mat-label>
        <mat-select formControlName="unidad" (selectionChange)="sendForm()">
          <mat-option value="G_CEL" selected>ºC</mat-option>
          <mat-option value="G_FAH">ºF</mat-option>
        </mat-select>
      </mat-form-field>
    </form>
  </div>
  <div class="body-wrapper">
    <div class="body-start">
      <h1 class="municipio">{{ municipioToDisplay ? municipioToDisplay : '&nbsp;' }}</h1>
      <h2 class="fecha">
        {{ (tomorrowDate | date: 'EEEE') | titlecase }}, {{ (tomorrowDate | date: 'd') }} de
        {{ (tomorrowDate | date: 'MMMM') }} de {{ (tomorrowDate | date: 'yyyy') }}
      </h2>
      <h3 class="temperatura-media" *ngIf="weatherResponse?.temperaturaMedia">
        {{ weatherResponse.temperaturaMedia ? weatherResponse.temperaturaMedia : '20' }}
        <span class="mini">{{ formGroup.controls['unidad'].value === 'G_CEL' ? 'ºC' : 'ºF' }}</span>
      </h3>
    </div>
    <div class="body-end">
      <mat-icon class="material-icons-filled" [class.rainy]="weatherIcon === 'rainy'"
        [class.sunny]="weatherIcon === 'sunny'">
        {{ weatherIcon }}
      </mat-icon>
    </div>
  </div>
  <div class="footer">
    <div class="probabilidad-lluvia" *ngIf="weatherResponse?.probabilidadPrecipitacion">
      @for (item of weatherResponse.probabilidadPrecipitacion; track item.autoGeneratedId) {
      <div class="franja">
        <span class="periodo">{{ item.periodo }}</span>
        <mat-progress-bar
          [attr.aria-label]="'Probabilidad de lluvia del ' + +item.probabilidad + ' en la franja horaria de ' + item.periodo"
          [value]="+item.probabilidad" />
        <span class="probabilidad">{{ item.probabilidad }}%</span>
      </div>
      }
    </div>
  </div>
</section>