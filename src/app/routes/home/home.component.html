<section class="mat-elevation-z11">
  <div class="header">
    <form [formGroup]="formGroup" (ngSubmit)="sendForm()">
      <mat-form-field class="municipio" appearance="outline" floatLabel="always">
        <mat-label>Municipio</mat-label>
        <input type="text" placeholder="Escribe para buscar un municipio..." aria-label="Number" matInput
          formControlName="municipio" [matAutocomplete]="auto">
        <mat-autocomplete #auto="matAutocomplete" (optionSelected)="sendForm()" [displayWith]="displayFn">
          @for (option of municipios; track option.id) {
          <mat-option [value]="option">{{option.nombre}}</mat-option>
          }
        </mat-autocomplete>
      </mat-form-field>
      <mat-form-field appearance="outline" class="unidad">
        <mat-label>Unidad</mat-label>
        <mat-select formControlName="unidad" (selectionChange)="sendForm()">
          <mat-option value="celsius" selected>ºC</mat-option>
          <mat-option value="fahrenheit">ºF</mat-option>
        </mat-select>
      </mat-form-field>
    </form>
  </div>
  <div class="body">
    <h1 class="municipio">{{ formGroup.controls['municipio'].value?.nombre }}</h1>
    <h2 class="fecha">
      {{ (tomorrowDate | date: 'EEEE') | titlecase }}, {{ (tomorrowDate | date: 'd') }} de
      {{ (tomorrowDate | date: 'MMMM') }} de {{ (tomorrowDate | date: 'yyyy') }}
    </h2>
    <h3 class="temperatura-media" *ngIf="weatherResponse?.temperaturaMedia">
      {{ weatherResponse.temperaturaMedia ? weatherResponse.temperaturaMedia : '20' }}
      <span class="mini">{{ formGroup.controls['unidad'].value === 'celsius' ? 'ºC' : 'ºF' }}</span>
    </h3>
    <div class="probabilidad-lluvia" *ngIf="weatherResponse?.probabilidadPrecipitacion">
      @for (item of weatherResponse.probabilidadPrecipitacion; track item.autoGeneratedId) {
      <div class="franja">
        <span>{{ item.periodo }}</span>
        <span>{{ item.probabilidad }}%</span>
      </div>
      }
    </div>
  </div>
</section>